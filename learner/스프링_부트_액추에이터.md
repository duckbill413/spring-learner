# 스프링 부트 액추에이터

- 애플리케이션이 상용 환경에서 배포되고 고가용성을 유지하기 위해서는 지속적인 모니터링이 필요하다.
- 모니터링에는 애플리케이션 상태 점검, 성능, 트래픽, 감사, 각종 측정지표, 재시작, 로그 레벨 변경 등의 다양한 작업이 필요하다.
- 스프링 부트 액추에이터는 모니터링과 관리에 필요한 기능을 제공한다.

> 의존성 추가
>> implementation 'org.springframework.boot:spring-boot-starter-actuator'

엑추에이터 엔드포인트는 웹(HTTP) 또는 JMX(java management extensions)를 통해 호출할 수 있으며, 액추에이터를 활성화/비활성화할 수 있다.  
예를 들어, `health`, `info`만 HTTP 접근이 노출되어 있고, 나머지는 노출되지 않는다.  
하지만, `JMX`는 `HTTP`보다 보안성이 높으므로 스프링 부트가 제공하는 모든 액추에이터 엔드포인트는 `JMX`에는 노출되어 있다.

- `/actuator`에 접속하면 현재 접속할 수 있는 액추에이터 엔드포인트 목록이 표시된다.
- 엔드포인트의 `templated` 값은 `true`이면 URL에 `{cache}`, `{toMatch}`와 같은 값을 지정할 수 있다.
- `http://localhost:8080/actuator/caches{cache}` 의 `{cache}` 대신 실제 캐시 이름을 지정하면 해당 캐시의 상태를 확인할 수 있다.

## 스프링 부트 액추에이터 엔드포인트

| 엔드포인트 이름         | 목적                                                                                                                 | HTTP 노출 | JMX 노출 |
|------------------|--------------------------------------------------------------------------------------------------------------------|---------|--------|
| auditevents      | 사용자 로그인/로그아웃 같은 보안 감사 정보 표시. `AuditEventRepository`빈 필요                                                            | X       | O      |
| beans            | 애플리케이션에 등록된 스프링 빈 전체 목록 표시                                                                                         | X       | O      |
| caches           | 애플리케이션에 사용된 모든 캐시 정보 표시                                                                                            | X       | O      |
| conditions       | 애플리케이션 설정 및 자동 구성에 사용된 조건과 조건에 부합하거나 부합하지 못하는 이유 표시                                                                | X       | O      |
| configprops      | `@ConfigurationProperties`으로 등록된 전체 설정 정보 표시                                                                       | X       | O      |
| env              | 스프링의 `ConfigurableEnvironment`로 등록된 모든 환경 설정 정보 표시                                                                 | X       | O      |
| flyway           | 플라이웨이 데이터베이스 마이그레이션 설정 정보 표시. 하나 이상의 Flyway 빈 필요                                                                   | X       | O      |
| health           | 애플리케이션 상태 정보 표시                                                                                                    | O       | O      |
| heapdump         | 애플리케이션이 사용 중인 JVM의 힙 덤프 파일 반환                                                                                      | X       | O      |
| httptrace        | 최근 100건의 HTTP 요청/응답 상세 정보 표시 `HttpTraceRepository` 빈을 설정해야 사용 가능                                                   | X       | O      |
| info             | 커스텀 데이터, 빌드 정보, 최신 커밋 등 애플리케이션 일반 정보 표시                                                                            | O       | O      |
| integrationgraph | 스프링 인티그레이션 컴포넌트 그래프 표시. `spring-integration-core` 의존 관계 필요                                                         | X       | O      |
| logfile          | 애플리케이션 로그 파일 내용 표시. `HTTP`의 `Range` 헤더를 사용해서 로그 파일 범위 지정 가능                                                        | X       | 해당 없음  |
| loggers          | 애플리케이션 로거 표시 및 로깅 설정                                                                                               | X       | O      |
| liquibase        | 리퀴베이스(liquibase) 데이터베이스 마이그레이션 설정 정보 표시 하나 이상의 `Liquibase` 빈 필요                                                    | X       | O      |
| metrics          | 애플리케이션 각종 측정 지표 표시                                                                                                 | X       | O      |
| mapping          | `@RequestMapping`으로 매핑된 모든 api 경로 표시                                                                               | X       | O      |
| prometheus       | 프로메테우스 서버로 수집할 수 있는 측정지표 표시 `micrometer-registry-prometheus` 의존 관계 필요                                              | X       | 해당없음   |
| scheduledtasks   | 주기적으로 실행되도록 설정된 작업 목록 표시                                                                                           | X       | O      |
| sessions         | 스프링 세션으로 관리하는 사용자 세션 정보 조회 및 삭제 스프링 세션을 사용하는 서블릿 기반의 웹 애플리케이션 사용 가능                                                | X       | O      |
| shutdown         | 애플리케이션 안전 종료(graceful shutdown)가 기본적으로 비활성화돼 있음                                                                    | X       | O      |
| startup          | `ApplicationStartup`으로 수집하는 애플리케이션 시작 단계별 데이터 표시 `SpringApplication` 클래스에 `BufferingApplicationSetup`이 설정돼 있어야 한다. | X       | O      |
| threaddump       | 스레드 덤프 출력                                                                                                          | X       | O      |


### 엔드포인트 관리
- 프로퍼티 설정을 변경하면 다른 엔드포인트도 `HTTP`로 노출
> management.endpoints.web.exposure.include
- 프로퍼티 설정을 변경하면 엔드포인트 `HTTP` 노출을 제외
> management.endpoints.web.exposure.exclude
- 기본 actuator 경로 변경
> management.endpoints.web.base-bath
- 개별 액추에이터 엔드포인트 이름 변경
> management.endpoints.web.path-mapping.health